{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/repositories/index.ts"],"names":[],"mappings":";;;AAAA,8DAAkE;AAElE,8DAA2D;AAC3D,wDAA+D;AAC/D,4CAA+C;AAC/C,0DAA8D;AAC9D,oDAA4C;AAC5C,sDAG8B;AAE9B,IAAY,UAOX;AAPD,WAAY,UAAU;IAClB,sBAAQ,CAAA;IACR,wBAAU,CAAA;IACV,sBAAQ,CAAA;IACR,sBAAQ,CAAA;IACR,wBAAU,CAAA;IACV,iCAAmB,CAAA;AACvB,CAAC,EAPW,UAAU,GAAV,kBAAU,KAAV,kBAAU,QAOrB;AACD,MAAa,UAAU;IAOnB,YAAY,EACR,MAAM,GAAG,WAAW,EACpB,OAAO,GAAG,2BAAe,GACb;QALT,eAAU,GAAG,UAAU,CAAC;QAM3B,IAAI,CAAC,MAAM,GAAG,IAAI,0BAAQ,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;QACvC,IAAI,CAAC,SAAS,GAAG,qCAAsB,CAAC,IAAI,CACxC,IAAI,CAAC,MAAM,EACX,iCAAe,CAClB,CAAC;QACF,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;IAC3B,CAAC;IAED,KAAK,CAAC,aAAa,CACf,EAAU,EACV,kBAA0B,EAC1B,cAAuB,KAAK;QAE5B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,CAAC,SAAS;aACjC,IAAI,CACD,IAAI,8BAAY,CAAC;YACb,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,gBAAgB,EAAE,IAAI;YACtB,sBAAsB,EAAE,UAAU;YAClC,gBAAgB,EACZ,IAAA,8CAAgC,EAAC,kBAAkB,CAAC;YACxD,yBAAyB,EAAE,IAAA,wBAAQ,EAAC;gBAChC,KAAK,EAAE,EAAE;gBACT,GAAG,IAAA,+CAAiC,EAChC,kBAAkB,CACrB;aACJ,CAAC;SACL,CAAC,CACL;aACA,KAAK,CAAC,kBAAK,CAAC,CAAC;QAElB,MAAM,QAAQ,GAAG,KAAK,CAAC,GAAG,CAAC,0BAAU,CAAC,CAAC;QACvC,OAAO,WAAW,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC;IAChD,CAAC;CACJ;AA7CD,gCA6CC","sourcesContent":["import { DynamoDB, QueryCommand } from '@aws-sdk/client-dynamodb';\nimport { IDynamoConfig } from '../interfaces';\nimport { translateConfig } from '../utils/translateConfig';\nimport { DynamoDBDocumentClient } from '@aws-sdk/lib-dynamodb';\nimport { DYNAMO_ENV_NAME } from '../constants';\nimport { marshall, unmarshall } from '@aws-sdk/util-dynamodb';\nimport { logIt } from '../utils/logItUtils';\nimport {\n    objectToEqualityFilterExpression,\n    objectToExpressionAttributeValues,\n} from '../utils/dynamoUtils';\n\nexport enum Comparator {\n    gt = '>',\n    gte = '>=',\n    eq = '=',\n    lt = '<',\n    lte = '<=',\n    between = 'BETWEEN',\n}\nexport class Repository {\n    public docClient;\n    public client;\n    protected envName;\n    public tableName;\n    public Comparator = Comparator;\n\n    constructor({\n        region = 'us-east-2',\n        envName = DYNAMO_ENV_NAME,\n    }: IDynamoConfig) {\n        this.client = new DynamoDB({ region });\n        this.docClient = DynamoDBDocumentClient.from(\n            this.client,\n            translateConfig\n        );\n        this.envName = envName;\n    }\n\n    async getByEquality(\n        pk: string,\n        equalityConditions: object,\n        isReturnOne: boolean = false\n    ) {\n        const { Items } = await this.docClient\n            .send(\n                new QueryCommand({\n                    TableName: this.tableName,\n                    ScanIndexForward: true,\n                    KeyConditionExpression: 'pk = :pk',\n                    FilterExpression:\n                        objectToEqualityFilterExpression(equalityConditions),\n                    ExpressionAttributeValues: marshall({\n                        ':pk': pk,\n                        ...objectToExpressionAttributeValues(\n                            equalityConditions\n                        ),\n                    }),\n                })\n            )\n            .catch(logIt);\n\n        const response = Items.map(unmarshall);\n        return isReturnOne ? response[0] : response;\n    }\n}\n"]}